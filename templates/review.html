{% extends "base.html" %}

{% block title %}Monument Reviews{% endblock %}

{% block content %}
<div class="reviews-container">
    <div class="reviews-header">
        <h1>Monument Reviews</h1>
        <p>Share your experiences and discover what others think about India's magnificent monuments</p>
        <div class="header-decoration">
            <span class="decoration-line"></span>
            <span class="decoration-dot"></span>
            <span class="decoration-line"></span>
        </div>
    </div>

    <div class="reviews-search">
        <div class="search-wrapper">
            <i class="fas fa-search search-icon"></i>
            <input type="text" id="reviewSearch" placeholder="Search reviews by monument, tags, or content..." class="form-control">
        </div>
        <div class="filter-options">
            <button class="filter-btn active" data-filter="all">All Reviews</button>
            <button class="filter-btn" data-filter="recent">Recent</button>
            <button class="filter-btn" data-filter="top">Top Rated</button>
        </div>
    </div>

    <div class="reviews-grid">
        {% for review in reviews %}
        <div class="review-card" data-rating="{{ review.rating }}" data-date="{{ review.created_at }}" data-review-id="{{ review.id }}">
            <div class="review-header">
                <div class="user-info">
                    <img src="{{ review.user.profile_pic if review.user.profile_pic else url_for('static', filename='images/user-avatar.png') }}" alt="{{ review.user.first_name }}" class="user-avatar">
                    <div class="review-info">
                        <span class="reviewer-name">{{ review.user.first_name }}</span>
                        <div class="review-stars">
                            {% for i in range(review.rating) %}
                            <span class="star">★</span>
                            {% endfor %}
                            {% for i in range(5 - review.rating) %}
                            <span class="star empty">☆</span>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <span class="review-date">{{ review.created_at }}</span>
            </div>
            <div class="monument-name">
                <i class="fas fa-landmark"></i>
                {{ review.monument_name }}
            </div>
            <p class="review-text">{{ review.review_text }}</p>
            {% if review.tags %}
            <div class="review-tags">
                {% for tag in review.tags %}
                <span class="tag"><i class="fas fa-tag"></i> {{ tag }}</span>
                {% endfor %}
            </div>
            {% endif %}
            {% if review.photos %}
            <div class="review-photos">
                {% for photo in review.photos %}
                <div class="photo-container">
                    <img src="{{ photo }}" alt="Review photo" class="review-photo">
                    <div class="photo-overlay">
                        <i class="fas fa-search-plus"></i>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            <div class="review-actions">
                <button class="action-btn like-btn">
                    <i class="far fa-heart"></i>
                    <span>Like</span>
                </button>
                <button class="action-btn comment-btn">
                    <i class="far fa-comment"></i>
                    <span>Comment</span>
                </button>
            </div>
            <div class="comments-section" style="display: none;">
                <div class="comments-list"></div>
                <div class="comment-form">
                    <textarea placeholder="Write a comment..." class="comment-input"></textarea>
                    <button class="post-comment-btn">Post</button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <button class="write-review-btn">
        <i class="fas fa-pen"></i>
        Write a Review
    </button>
</div>

<style>
/* Modern Color Scheme */
:root {
    --primary-color: #f1683a;
    --primary-dark: #e45728;
    --secondary-color: #2c3e50;
    --accent-color: #3498db;
    --text-color: #f8f9fa;
    --text-light: #aaaaaa;
    --background-dark: #000000;
    --background-light: #1a1a1a;
    --card-bg: #111111;
    --card-border: #2a2a2a;
    --white: #ffffff;
    --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    --shadow-hover: 0 8px 12px rgba(0, 0, 0, 0.4);
}

body {
    background-color: var(--background-dark);
    color: var(--text-color);
}

.reviews-container {
    padding: 2rem;
    max-width: 1200px;
    margin: 0 auto;
    background: var(--background-dark);
}

.reviews-header {
    text-align: center;
    margin-bottom: 3rem;
    position: relative;
}

.reviews-header h1 {
    color: var(--primary-color);
    font-size: 2.8rem;
    margin-bottom: 1rem;
    font-weight: 700;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    animation: fadeInDown 0.8s ease;
}

.reviews-header p {
    color: var(--text-light);
    font-size: 1.2rem;
    max-width: 600px;
    margin: 0 auto;
    line-height: 1.6;
    animation: fadeInUp 0.8s ease;
}

.header-decoration {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-top: 1.5rem;
    animation: fadeIn 1s ease;
}

.decoration-line {
    height: 2px;
    width: 100px;
    background: linear-gradient(to right, transparent, var(--primary-color), transparent);
}

.decoration-dot {
    width: 8px;
    height: 8px;
    background: var(--primary-color);
    border-radius: 50%;
    margin: 0 1rem;
}

.reviews-search {
    max-width: 800px;
    margin: 0 auto 3rem;
}

.search-wrapper {
    position: relative;
    margin-bottom: 1rem;
}

.search-icon {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-light);
}

.reviews-search input {
    padding: 1.2rem 1rem 1.2rem 3rem;
    border-radius: 30px;
    border: 2px solid #333333;
    font-size: 1.1rem;
    width: 100%;
    transition: all 0.3s ease;
    background: var(--background-light);
    color: var(--text-color);
}

.reviews-search input:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 15px rgba(241, 104, 58, 0.2);
    outline: none;
}

.filter-options {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-top: 1rem;
}

.filter-btn {
    padding: 0.5rem 1.5rem;
    border: none;
    border-radius: 20px;
    background: var(--background-light);
    color: var(--text-color);
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.3s ease;
}

.filter-btn.active {
    background: var(--primary-color);
    color: var(--white);
}

.reviews-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
}

.review-card {
    background: var(--card-bg);
    border-radius: 20px;
    padding: 1.8rem;
    box-shadow: var(--shadow);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    animation: fadeIn 0.5s ease;
    border: 1px solid var(--card-border);
}

.review-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-hover);
    border-color: var(--primary-color);
}

.review-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(to right, var(--primary-color), var(--accent-color));
    opacity: 0;
    transition: opacity 0.3s ease;
}

.review-card:hover::before {
    opacity: 1;
}

.review-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1.2rem;
}

.user-info {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.user-avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid var(--primary-color);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    cursor: pointer;
}

.user-avatar:hover {
    transform: scale(1.1);
    box-shadow: 0 0 10px rgba(241, 104, 58, 0.5);
}

.review-info {
    flex: 1;
}

.reviewer-name {
    font-weight: 600;
    color: var(--text-color);
    font-size: 1.1rem;
    display: block;
}

.review-stars {
    color: #ffd700;
    font-size: 1.2rem;
    margin-top: 0.2rem;
}

.review-stars .star.empty {
    color: #ddd;
}

.review-date {
    color: var(--text-light);
    font-size: 0.9rem;
}

.monument-name {
    font-size: 1.3rem;
    color: var(--primary-color);
    margin-bottom: 1rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.review-text {
    color: var(--text-light);
    line-height: 1.6;
    margin-bottom: 1.2rem;
    font-size: 1rem;
}

.review-tags {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    margin-bottom: 1.2rem;
}

.tag {
    background: var(--background-light);
    padding: 0.4rem 0.8rem;
    border-radius: 15px;
    font-size: 0.85rem;
    color: var(--text-color);
    display: flex;
    align-items: center;
    gap: 0.3rem;
    transition: all 0.3s ease;
}

.tag:hover {
    background: var(--primary-color);
    color: var(--white);
    transform: translateY(-2px);
}

.review-photos {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 1rem;
    margin: 1.2rem 0;
}

.photo-container {
    position: relative;
    border-radius: 15px;
    overflow: hidden;
    aspect-ratio: 1;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
}

.review-photo {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.photo-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: all 0.3s ease;
}

.photo-overlay i {
    color: var(--white);
    font-size: 2rem;
    transform: scale(0.8);
    transition: transform 0.3s ease;
}

.photo-container:hover .photo-overlay {
    opacity: 1;
}

.photo-container:hover .photo-overlay i {
    transform: scale(1);
}

.photo-container:hover .review-photo {
    transform: scale(1.1);
}

.review-actions {
    display: flex;
    gap: 1rem;
    margin-top: 1.2rem;
    padding-top: 1rem;
    border-top: 1px solid #eee;
}

.action-btn {
    flex: 1;
    padding: 0.8rem;
    border: none;
    background: var(--background-light);
    color: var(--text-light);
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    border-radius: 12px;
}

.action-btn:hover {
    background: var(--primary-dark);
    color: var(--white);
}

.write-review-btn {
    display: block;
    margin: 2rem auto;
    padding: 1rem 2.5rem;
    background: var(--primary-color);
    color: var(--white);
    border: none;
    border-radius: 30px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 6px rgba(241, 104, 58, 0.2);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.write-review-btn:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(241, 104, 58, 0.3);
}

/* Animations */
@keyframes fadeInDown {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

/* Responsive Design */
@media (max-width: 768px) {
    .reviews-container {
        padding: 1rem;
    }

    .reviews-header h1 {
        font-size: 2rem;
    }

    .reviews-grid {
        grid-template-columns: 1fr;
    }

    .filter-options {
        flex-wrap: wrap;
    }

    .filter-btn {
        flex: 1;
        min-width: 100px;
    }
}

/* Modal Styles */
.review-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 1000;
    backdrop-filter: blur(8px);
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.review-modal.show {
    opacity: 1;
    visibility: visible;
}

.modal-content {
    background: var(--card-bg);
    margin: 2% auto;
    padding: 1.5rem;
    border-radius: 20px;
    width: 90%;
    max-width: 450px;
    max-height: 85vh;
    overflow-y: auto;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    position: relative;
    transform: translateY(-50px);
    opacity: 0;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1px solid var(--card-border);
}

/* Add custom scrollbar styles */
.modal-content::-webkit-scrollbar {
    width: 8px;
}

.modal-content::-webkit-scrollbar-track {
    background: var(--background-light);
    border-radius: 4px;
}

.modal-content::-webkit-scrollbar-thumb {
    background: var(--primary-color);
    border-radius: 4px;
}

.modal-content::-webkit-scrollbar-thumb:hover {
    background: var(--primary-dark);
}

.review-modal.show .modal-content {
    transform: translateY(0);
    opacity: 1;
}

.modal-content h2 {
    color: var(--text-color);
    font-size: 1.3rem;
    margin-bottom: 1rem;
    text-align: left;
    font-weight: 600;
}

.form-group {
    margin-bottom: 1rem;
    opacity: 0;
    transform: translateY(20px);
    transition: all 0.3s ease;
}

.review-modal.show .form-group {
    opacity: 1;
    transform: translateY(0);
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    color: var(--text-color);
    font-weight: 500;
    font-size: 0.9rem;
}

.rating {
    display: flex;
    flex-direction: row;
    justify-content: flex-start;
    gap: 0.8rem;
    margin: 0.8rem 0;
    padding: 0.5rem;
    background: var(--background-light);
    border-radius: 15px;
    width: fit-content;
}

.rating input[type="radio"] {
    display: none;
}

.rating label {
    cursor: pointer;
    font-size: 2rem;
    color: #ddd;
    transition: all 0.3s ease;
    padding: 0.2rem;
    line-height: 1;
}

.rating label:hover,
.rating label:hover ~ label,
.rating input[type="radio"]:checked ~ label {
    color: #ffd700;
    transform: scale(1.2);
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
}

select, textarea {
    width: 100%;
    padding: 0.8rem;
    border: 1px solid var(--card-border);
    border-radius: 12px;
    font-size: 1rem;
    background: var(--background-light);
    color: var(--text-color);
    transition: all 0.3s ease;
}

select:focus, textarea:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(241, 104, 58, 0.2);
    outline: none;
}

.tags-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 0.8rem;
    padding: 1rem;
    border-radius: 15px;
    background: var(--background-light);
}

.tag {
    display: inline-flex;
    align-items: center;
    padding: 0.4rem 0.8rem;
    background: var(--card-bg);
    border-radius: 6px;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 1px solid var(--card-border);
}

.tag input[type="checkbox"] {
    margin-right: 6px;
    width: 16px;
    height: 16px;
}

.photo-upload-container {
    position: relative;
    padding: 2rem;
    border: 2px dashed var(--primary-color);
    border-radius: 15px;
    text-align: center;
    transition: all 0.3s ease;
    background: var(--background-light);
    cursor: pointer;
    margin-top: 0.8rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
}

.photo-upload-container i {
    font-size: 2rem;
    color: var(--primary-color);
    margin-bottom: 0.5rem;
}

.photo-upload-container p {
    margin: 0;
    color: var(--text-color);
}

.photo-upload-container .upload-info {
    font-size: 0.85rem;
    color: var(--text-light);
}

.photo-upload-container:hover {
    background: rgba(241, 104, 58, 0.1);
    border-color: var(--primary-dark);
    transform: translateY(-2px);
}

.photo-upload-container input[type="file"] {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    cursor: pointer;
}

.submit-btn {
    background: var(--primary-color);
    color: var(--white);
    padding: 1rem;
    border: none;
    border-radius: 15px;
    font-size: 1.1rem;
    font-weight: 600;
    width: 100%;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 1.5rem;
    box-shadow: 0 4px 10px rgba(241, 104, 58, 0.2);
}

.submit-btn:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(241, 104, 58, 0.3);
}

.close-modal {
    position: absolute;
    top: 1rem;
    right: 1rem;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: var(--background-light);
    color: var(--text-color);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 1.5rem;
    border: none;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
}

.close-modal:hover {
    background: var(--primary-color);
    color: var(--white);
    transform: rotate(90deg) scale(1.1);
}

/* Image Preview Modal */
.image-preview-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    z-index: 1100;
    display: none;
    justify-content: center;
    align-items: center;
    backdrop-filter: blur(10px);
}

.image-preview-modal.show {
    display: flex;
    animation: fadeIn 0.3s ease;
}

.preview-image {
    max-width: 90%;
    max-height: 90vh;
    object-fit: contain;
    border-radius: 10px;
    box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);
    animation: scaleIn 0.3s ease;
}

.preview-close {
    position: absolute;
    top: 20px;
    right: 20px;
    width: 40px;
    height: 40px;
    color: var(--white);
    font-size: 2rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 50%;
    backdrop-filter: blur(5px);
}

.preview-close:hover {
    transform: rotate(90deg);
    background: rgba(255, 255, 255, 0.2);
}

@keyframes scaleIn {
    from {
        transform: scale(0.9);
        opacity: 0;
    }
    to {
        transform: scale(1);
        opacity: 1;
    }
}

/* Photo Preview Styles */
.photo-preview {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
}

.preview-item {
    position: relative;
    border-radius: 12px;
    overflow: hidden;
    aspect-ratio: 1;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
}

.preview-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.preview-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.preview-item:hover img {
    transform: scale(1.1);
}

.preview-item .remove-preview {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 24px;
    height: 24px;
    background: rgba(231, 76, 60, 0.9);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
        opacity: 0;
    transform: scale(0.8);
    transition: all 0.3s ease;
    }

.preview-item:hover .remove-preview {
        opacity: 1;
    transform: scale(1);
}

.preview-item .remove-preview:hover {
    background: #c0392b;
    transform: scale(1.1);
}

.comments-section {
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid #eee;
}

.comment-form {
    display: flex;
    gap: 1rem;
    margin-top: 1rem;
}

.comment-input {
    flex: 1;
    padding: 0.8rem;
    border: 1px solid var(--card-border);
    border-radius: 12px;
    font-size: 0.9rem;
    resize: none;
    min-height: 40px;
    transition: all 0.3s ease;
    background: var(--background-light);
    color: var(--text-color);
}

.comment-input:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(241, 104, 58, 0.2);
    outline: none;
}

.post-comment-btn {
    padding: 0.8rem 1.5rem;
    background: var(--primary-color);
    color: white;
    border: none;
    border-radius: 12px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
}

.post-comment-btn:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
}

.comments-list {
    margin-top: 1rem;
}

.comment-item {
    display: flex;
    gap: 1rem;
    padding: 1rem;
    border-radius: 12px;
    background: var(--background-light);
    margin-bottom: 0.8rem;
    animation: fadeIn 0.3s ease;
}

.comment-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    object-fit: cover;
    border: 1px solid var(--primary-color);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    cursor: pointer;
}

.comment-avatar:hover {
    transform: scale(1.1);
    box-shadow: 0 0 6px rgba(241, 104, 58, 0.5);
}

.comment-content {
    flex: 1;
}

.comment-author {
    font-weight: 600;
    color: var(--text-color);
    font-size: 0.9rem;
}

.comment-text {
    margin-top: 0.3rem;
    color: var(--text-light);
    font-size: 0.9rem;
}

.comment-date {
    color: var(--text-light);
    font-size: 0.8rem;
    margin-top: 0.3rem;
}

/* Notification Styles */
.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 1rem 2rem;
    border-radius: 12px;
    color: white;
    font-weight: 500;
    transform: translateX(100%);
    opacity: 0;
    transition: all 0.3s ease;
    z-index: 2000;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    display: flex;
    align-items: center;
    gap: 0.8rem;
}

.notification.show {
    transform: translateX(0);
    opacity: 1;
}

.notification.success {
    background: linear-gradient(to right, #2ecc71, #27ae60);
}

.notification.error {
    background: linear-gradient(to right, #e74c3c, #c0392b);
}

.notification::before {
    font-family: "Font Awesome 5 Free";
    font-weight: 900;
}

.notification.success::before {
    content: "\f00c";
}

.notification.error::before {
    content: "\f071";
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Search functionality
    const searchInput = document.getElementById('reviewSearch');
    const reviewCards = document.querySelectorAll('.review-card');
    
    searchInput.addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase();
        
        reviewCards.forEach(card => {
            const text = card.textContent.toLowerCase();
            const rating = parseInt(card.dataset.rating);
            const date = new Date(card.dataset.date);
            
            if (text.includes(searchTerm)) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    });

    // Filter functionality
    const filterButtons = document.querySelectorAll('.filter-btn');
    
    filterButtons.forEach(button => {
        button.addEventListener('click', function() {
            filterButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            
            const filter = this.dataset.filter;
            const now = new Date();
            
            reviewCards.forEach(card => {
                const date = new Date(card.dataset.date);
                const rating = parseInt(card.dataset.rating);
                
                switch(filter) {
                    case 'recent':
                        const daysDiff = Math.floor((now - date) / (1000 * 60 * 60 * 24));
                        card.style.display = daysDiff <= 7 ? 'block' : 'none';
                        break;
                    case 'top':
                        card.style.display = rating >= 4 ? 'block' : 'none';
                        break;
                    default:
                        card.style.display = 'block';
                }
            });
        });
    });

    // Image preview functionality
    const photoContainers = document.querySelectorAll('.photo-container');
    photoContainers.forEach(container => {
        container.addEventListener('click', function() {
            const img = this.querySelector('.review-photo');
            showImagePreview(img.src);
        });
    });
    
    // User avatar preview functionality
    const userAvatars = document.querySelectorAll('.user-avatar');
    userAvatars.forEach(avatar => {
        avatar.addEventListener('click', function() {
            showImagePreview(this.src);
        });
    });

    // Write Review Button Click Handler
    const writeReviewBtn = document.querySelector('.write-review-btn');
    if (writeReviewBtn) {
        writeReviewBtn.addEventListener('click', function() {
            showReviewModal();
        });
    }

    // Like button functionality
    const likeButtons = document.querySelectorAll('.like-btn');
    
    likeButtons.forEach(button => {
        button.addEventListener('click', function() {
            const icon = this.querySelector('i');
            icon.classList.toggle('fas');
            icon.classList.toggle('far');
            
            if (icon.classList.contains('fas')) {
                this.style.color = '#e74c3c';
            } else {
                this.style.color = '';
            }
        });
    });

    // Comment functionality
    document.querySelectorAll('.comment-btn').forEach(button => {
        button.addEventListener('click', function() {
            const reviewCard = this.closest('.review-card');
            const commentsSection = reviewCard.querySelector('.comments-section');
            
            if (commentsSection.style.display === 'none') {
                commentsSection.style.display = 'block';
                loadComments(reviewCard.dataset.reviewId, commentsSection.querySelector('.comments-list'));
            } else {
                commentsSection.style.display = 'none';
            }
        });
    });

    // Post comment functionality
    document.querySelectorAll('.post-comment-btn').forEach(button => {
        button.addEventListener('click', async function() {
            const reviewCard = this.closest('.review-card');
            const commentInput = reviewCard.querySelector('.comment-input');
            const commentText = commentInput.value.trim();
            
            if (!commentText) {
                showNotification('Please write a comment first.', 'error');
                return;
            }
            
            try {
                button.disabled = true;
                button.textContent = 'Posting...';
                
                const response = await fetch(`/api/reviews/${reviewCard.dataset.reviewId}/comments`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest',
                        'X-CSRFToken': getCookie('csrftoken') // Add CSRF token if using Django
                    },
                    body: JSON.stringify({ text: commentText }),
                    credentials: 'same-origin'
                });
                
                if (response.ok) {
                    const comment = await response.json();
                    addCommentToList(comment, reviewCard.querySelector('.comments-list'));
                    commentInput.value = '';
                    showNotification('Comment posted successfully!', 'success');
                } else {
                    throw new Error('Failed to post comment');
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification('Failed to post comment. Please try again.', 'error');
            } finally {
                button.disabled = false;
                button.textContent = 'Post';
            }
        });
    });
});

function showImagePreview(src) {
    const modal = document.createElement('div');
    modal.className = 'image-preview-modal';
    modal.innerHTML = `
        <img src="${src}" class="preview-image">
        <span class="preview-close">&times;</span>
    `;
    
    document.body.appendChild(modal);
    
    // Force a reflow
    modal.offsetHeight;
    
    // Add show class
    modal.classList.add('show');
    
    // Close handlers
    function closePreview() {
        modal.classList.remove('show');
        setTimeout(() => modal.remove(), 300);
    }
    
    modal.querySelector('.preview-close').addEventListener('click', closePreview);
    modal.addEventListener('click', (e) => {
        if (e.target === modal) closePreview();
    });
}

function showReviewModal() {
            const modal = document.createElement('div');
            modal.className = 'review-modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <button class="close-modal">&times;</button>
            <h2>Your Review</h2>
                    <form id="reviewForm" enctype="multipart/form-data">
                        <div class="form-group">
                            <label for="monument">Select Monument</label>
                            <select id="monument" name="monument" required>
                                <option value="">Choose a monument...</option>
                                <option value="Taj Mahal">Taj Mahal</option>
                                <option value="Red Fort">Red Fort</option>
                                <option value="Qutub Minar">Qutub Minar</option>
                                <option value="India Gate">India Gate</option>
                        <option value="Hawa Mahal">Hawa Mahal</option>
                        <option value="Mehrangarh Fort">Mehrangarh Fort</option>
                        <option value="Golden Temple">Golden Temple</option>
                        <option value="Mysore Palace">Mysore Palace</option>
                        <option value="Charminar">Charminar</option>
                        <option value="Gateway of India">Gateway of India</option>
                        <option value="Victoria Memorial">Victoria Memorial</option>
                        <option value="Humayun's Tomb">Humayun's Tomb</option>
                        <option value="Fatehpur Sikri">Fatehpur Sikri</option>
                        <option value="Khajuraho Temples">Khajuraho Temples</option>
                        <option value="Konark Sun Temple">Konark Sun Temple</option>
                        <option value="Mahabodhi Temple">Mahabodhi Temple</option>
                        <option value="Sanchi Stupa">Sanchi Stupa</option>
                        <option value="Ajanta Caves">Ajanta Caves</option>
                        <option value="Ellora Caves">Ellora Caves</option>
                        <option value="Brihadeeswarar Temple">Brihadeeswarar Temple</option>
                        <option value="Meenakshi Temple">Meenakshi Temple</option>
                        <option value="Lotus Temple">Lotus Temple</option>
                        <option value="Akshardham Temple">Akshardham Temple</option>
                        <option value="Jama Masjid">Jama Masjid</option>
                        <option value="Rashtrapati Bhavan">Rashtrapati Bhavan</option>
                        <option value="Sundarbans">Sundarbans</option>
                        <option value="Valley of Flowers">Valley of Flowers</option>
                        <option value="Kaziranga National Park">Kaziranga National Park</option>
                        <option value="Other">Other</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <div class="rating">
                                <input type="radio" id="star5" name="rating" value="5" required>
                        <label for="star5">★</label>
                                <input type="radio" id="star4" name="rating" value="4">
                        <label for="star4">★</label>
                                <input type="radio" id="star3" name="rating" value="3">
                        <label for="star3">★</label>
                                <input type="radio" id="star2" name="rating" value="2">
                        <label for="star2">★</label>
                                <input type="radio" id="star1" name="rating" value="1">
                        <label for="star1">★</label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                    <textarea id="review" name="review" placeholder="Share your experience..." required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>Tags</label>
                            <div class="tags-container">
                                <label class="tag"><input type="checkbox" name="tags" value="Historical"> Historical</label>
                                <label class="tag"><input type="checkbox" name="tags" value="Architecture"> Architecture</label>
                                <label class="tag"><input type="checkbox" name="tags" value="Photography"> Photography</label>
                                <label class="tag"><input type="checkbox" name="tags" value="Cultural"> Cultural</label>
                                <label class="tag"><input type="checkbox" name="tags" value="Family-friendly"> Family-friendly</label>
                                <label class="tag"><input type="checkbox" name="tags" value="Educational"> Educational</label>
                                <label class="tag"><input type="checkbox" name="tags" value="Spiritual"> Spiritual</label>
                                <label class="tag"><input type="checkbox" name="tags" value="Adventure"> Adventure</label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                    <label>Add Photos</label>
                            <div class="photo-upload-container">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Click to upload photos</p>
                        <span class="upload-info">Supports: JPG, PNG, JPEG (Max 5MB each)</span>
                                <input type="file" id="photos" name="photos" accept="image/*" multiple>
                            </div>
                            <div id="photoPreview" class="photo-preview"></div>
                        </div>
                        
                        <button type="submit" class="submit-btn">Submit Review</button>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
    // Force a reflow
            modal.offsetHeight;
            
    // Add show class
                modal.classList.add('show');

    // Animate form groups
            const formGroups = modal.querySelectorAll('.form-group');
            formGroups.forEach((group, index) => {
                setTimeout(() => {
                    group.style.opacity = '1';
                    group.style.transform = 'translateY(0)';
                }, 100 + (index * 100));
            });

            // Form submission handler
            const form = modal.querySelector('#reviewForm');
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = new FormData();
                formData.append('monument_name', document.getElementById('monument').value);
                formData.append('rating', document.querySelector('input[name="rating"]:checked').value);
                formData.append('review_text', document.getElementById('review').value);
                
                const selectedTags = Array.from(document.querySelectorAll('input[name="tags"]:checked'))
                    .map(checkbox => checkbox.value);
                formData.append('tags', JSON.stringify(selectedTags));
                
                const photoFiles = document.getElementById('photos').files;
                for (let i = 0; i < photoFiles.length; i++) {
                    formData.append('photos', photoFiles[i]);
                }
                
                try {
                    const response = await fetch('/api/reviews', {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (response.ok) {
                showNotification('Review submitted successfully!', 'success');
                setTimeout(() => window.location.reload(), 1500);
                    } else {
                        const errorData = await response.json();
                showNotification(errorData.error || 'Failed to submit review. Please try again.', 'error');
                    }
                } catch (error) {
                    console.error('Error:', error);
            showNotification('Failed to submit review. Please try again.', 'error');
                }
            });

            // Close modal handlers
            function closeModal() {
                modal.classList.remove('show');
        setTimeout(() => modal.remove(), 300);
            }

            modal.querySelector('.close-modal').addEventListener('click', closeModal);
            modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
            });

            // Star rating interaction
            const stars = modal.querySelectorAll('.rating label');
            stars.forEach(star => {
                star.addEventListener('mouseover', () => {
                    const currentRating = star.getAttribute('for').replace('star', '');
                    stars.forEach(s => {
                        const rating = s.getAttribute('for').replace('star', '');
                        if (rating <= currentRating) {
                            s.style.transform = 'scale(1.2) rotate(-5deg)';
                            s.style.color = '#ffd700';
                        }
                    });
                });

                star.addEventListener('mouseout', () => {
                    stars.forEach(s => {
                        if (!s.previousElementSibling.checked) {
                            s.style.transform = '';
                            s.style.color = '#ddd';
                        }
                    });
                });

                star.addEventListener('click', () => {
                    const input = star.previousElementSibling;
                    input.checked = true;
                    stars.forEach(s => {
                        const rating = s.getAttribute('for').replace('star', '');
                        if (rating <= input.value) {
                            s.style.color = '#ffd700';
                        } else {
                            s.style.color = '#ddd';
                        }
                    });
                });
            });

            // Photo upload preview
            const photoInput = modal.querySelector('#photos');
            const photoPreview = modal.querySelector('#photoPreview');
            
            photoInput.addEventListener('change', (e) => {
        const files = Array.from(e.target.files);
        const maxSize = 5 * 1024 * 1024; // 5MB
        
        files.forEach((file, index) => {
            if (file.size > maxSize) {
                showNotification(`File "${file.name}" exceeds 5MB limit`, 'error');
                return;
            }
            
                    const reader = new FileReader();
                    reader.onload = (e) => {
                const previewItem = document.createElement('div');
                previewItem.className = 'preview-item';
                previewItem.innerHTML = `
                    <img src="${e.target.result}" alt="Preview">
                    <div class="remove-preview" title="Remove photo">
                        <i class="fas fa-times"></i>
                    </div>
                `;
                
                // Add remove functionality
                previewItem.querySelector('.remove-preview').addEventListener('click', function() {
                    previewItem.style.opacity = '0';
                    previewItem.style.transform = 'scale(0.8)';
                    setTimeout(() => previewItem.remove(), 300);
                    
                    // Create new FileList without the removed file
                    const dt = new DataTransfer();
                    const input = document.getElementById('photos');
                    const { files } = input;
                    
                    for (let i = 0; i < files.length; i++) {
                        const file = files[i];
                        if (i !== index) dt.items.add(file);
                    }
                    
                    input.files = dt.files;
                });
                
                photoPreview.appendChild(previewItem);
                
                // Animate the preview item
                setTimeout(() => {
                    previewItem.style.opacity = '1';
                    previewItem.style.transform = 'translateY(0)';
                }, 50 * index);
            };
            reader.readAsDataURL(file);
        });
    });
}

function showNotification(message, type = 'success') {
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    // Force a reflow
    notification.offsetHeight;
    
    // Add show class
    notification.classList.add('show');
    
    // Remove after 3 seconds
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}

// Helper function to load comments
async function loadComments(reviewId, commentsList) {
    try {
        const response = await fetch(`/api/reviews/${reviewId}/comments`);
        if (response.ok) {
            const comments = await response.json();
            commentsList.innerHTML = '';
            comments.forEach(comment => addCommentToList(comment, commentsList));
            
            // Add click event listeners to comment avatars
            commentsList.querySelectorAll('.comment-avatar').forEach(avatar => {
                avatar.addEventListener('click', function() {
                    showImagePreview(this.src);
                });
            });
        } else {
            throw new Error('Failed to load comments');
        }
    } catch (error) {
        console.error('Error:', error);
        showNotification('Failed to load comments. Please try again.', 'error');
    }
}

// Helper function to add a comment to the list
function addCommentToList(comment, commentsList) {
    const commentElement = document.createElement('div');
    commentElement.className = 'comment-item';
    commentElement.innerHTML = `
        <img src="${comment.user.profile_pic ? comment.user.profile_pic : '/static/images/user-avatar.png'}" alt="${comment.user.first_name}" class="comment-avatar">
        <div class="comment-content">
            <div class="comment-author">${comment.user.first_name}</div>
            <div class="comment-text">${comment.text}</div>
            <div class="comment-date">${formatDate(comment.created_at)}</div>
        </div>
    `;
    commentsList.appendChild(commentElement);
    
    // Add click event listener to the comment avatar
    const avatar = commentElement.querySelector('.comment-avatar');
    if (avatar) {
        avatar.addEventListener('click', function() {
            showImagePreview(this.src);
        });
    }
}

// Helper function to format date
function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    });
}

// Helper function to get CSRF token from cookies (for Django)
function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if (parts.length === 2) {
        const cookieValue = parts.pop().split(';').shift();
        return cookieValue ? decodeURIComponent(cookieValue) : null;
    }
    return null;
}
</script>
{% endblock %} 